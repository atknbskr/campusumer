<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campus Summer Ã–ÄŸrenci GiriÅŸ</title>
    <link rel="stylesheet" href="Ã¶ÄŸrenci-giriÅŸ.css" />
  </head>
  <body>
    <div class="container">
      <div class="login-panel">
        <img src="2.3.logo.png" alt="Campus Summer Logo" class="logo" />
        <h2>Campus Summer</h2>
        <div class="user-type">Ã–ÄŸrenci</div>
        <form id="loginForm">
          <label for="studentNumber">Okul NumarasÄ±:</label>
          <input type="text" id="studentNumber" name="studentNumber" required />

          <label for="password">Åifre</label>
          <input type="password" id="password" name="password" required />

          <div id="errorMessage" class="error-message"></div>
          <div id="successMessage" class="success-message"></div>

          <button type="submit" class="login-btn">GiriÅŸ</button>
          <a href="#" class="forgot-password">Åifre SÄ±fÄ±rla</a>
        </form>

        <p class="register-link">
          HesabÄ±nÄ±z yok mu?
          <a href="../Ã¶ÄŸrenci-kayÄ±t/Ã¶ÄŸrenci-kayÄ±t.html">KayÄ±t Ol</a>
        </p>
      </div>

      <div class="announcement-panel">
        <h3>ğŸ“¢ DUYURULAR</h3>
        <div id="announcementsContainer">
          <p style="text-align: center; color: #666;">Duyurular yÃ¼kleniyor...</p>
        </div>
      </div>
    </div>

    <script>
      const API_URL = `${window.location.origin}/api`;

      // DuyurularÄ± yÃ¼kle
      async function loadAnnouncements() {
        try {
          const response = await fetch(`${API_URL}/announcements?targetAudience=student`);
          const data = await response.json();

          const container = document.getElementById("announcementsContainer");

          if (data.success && data.announcements.length > 0) {
            container.innerHTML = data.announcements
              .map((announcement, index) => {
                const priorityClass = 
                  announcement.priority === 3 ? "urgent" : 
                  announcement.priority === 2 ? "important" : "";
                
                return `
                  <div class="announcement-item ${priorityClass}">
                    <h2 class="${announcement.priority >= 2 ? 'red-text italic' : ''}">${announcement.title}</h2>
                    <p><strong>${index + 1}.</strong> ${announcement.content}</p>
                  </div>
                `;
              })
              .join("");
          } else {
            container.innerHTML = '<p style="text-align: center; color: #666;">Åu anda duyuru bulunmamaktadÄ±r.</p>';
          }
        } catch (error) {
          console.error("Duyuru yÃ¼kleme hatasÄ±:", error);
          document.getElementById("announcementsContainer").innerHTML = 
            '<p style="text-align: center; color: #999;">Duyurular yÃ¼klenemedi.</p>';
        }
      }

      // Sayfa yÃ¼klendiÄŸinde duyurularÄ± getir
      window.addEventListener("DOMContentLoaded", loadAnnouncements);

      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const errorDiv = document.getElementById("errorMessage");
          const successDiv = document.getElementById("successMessage");
          errorDiv.textContent = "";
          successDiv.textContent = "";

          const studentNumber = document
            .getElementById("studentNumber")
            .value.trim();
          const password = document.getElementById("password").value;

          try {
            const response = await fetch(`${API_URL}/auth/student/login`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ studentNumber, password }),
            });

            const data = await response.json();
            console.log("Ã–ÄŸrenci giriÅŸ yanÄ±tÄ±:", {
              status: response.status,
              body: data,
            });

            if (response.ok && data.success) {
              successDiv.textContent =
                "GiriÅŸ baÅŸarÄ±lÄ±! YÃ¶nlendiriliyorsunuz...";
              localStorage.setItem("token", data.token);
              localStorage.setItem("user", JSON.stringify(data.user));

              setTimeout(() => {
                window.location.href = "../campusumer-anasayfa/anasayfa.html";
              }, 1000);
            } else {
              errorDiv.textContent =
                data.message || "GiriÅŸ sÄ±rasÄ±nda bir hata oluÅŸtu";
            }
          } catch (error) {
            console.error("GiriÅŸ hatasÄ±:", error);
            errorDiv.textContent =
              "Sunucuya baÄŸlanÄ±lamadÄ±. LÃ¼tfen tekrar deneyin.";
          }
        });
    </script>
  </body>
</html>
