<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dersler - Campus Summer</title>
    <link rel="stylesheet" href="anasayfa.css">
    <link rel="stylesheet" href="dersler.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="2.3.logo.png" alt="Campus Summer Logo">
                <span>Campus Summer</span> 
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="../campusumer-anasayfa/anasayfa.html" class="nav-link active">Anasayfa</a>
                </div>
                <div class="nav-item">
                    <a href="../Dersler/dersler.html" class="nav-link">Dersler</a>
                </div>
                <div class="nav-item">
                    <a href="../Ãœniversiteler/Ãœniversitler.html" class="nav-link">Ãœniversiteler</a>
                </div>
                <div class="nav-item">
                    <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html" class="nav-link">HakkÄ±mÄ±zda</a>
                </div>
                <div class="nav-item">
                    <a href="../Ä°letiÅŸim/iletisim.html" class="nav-link">Ä°letiÅŸim</a>
                </div>
            </nav>

            
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Yaz Dersleri</h1>
                <p>200+ Ã¼niversiteden binlerce yaz dersi seÃ§eneÄŸi ile akademik hedeflerinize ulaÅŸÄ±n</p>
            </div>
        </div>
    </section>

    <!-- Akademisyen Ders Ekleme Formu -->
    <section id="academicianSection" class="academician-section" style="display: none;">
        <div class="container">
            <div class="section-header">
                <h2>Ders Ekle</h2>
                <p>Yeni bir ders ekleyin</p>
            </div>
            <div class="add-course-form-container">
                <form id="addCourseForm" class="add-course-form">
                    <div class="form-group">
                        <label for="courseName">Ders AdÄ± *</label>
                        <input type="text" id="courseName" name="courseName" required>
                    </div>
                    <div class="form-group">
                        <label for="courseCode">Ders Kodu</label>
                        <input type="text" id="courseCode" name="courseCode">
                    </div>
                    <div class="form-group">
                        <label for="category">Kategori</label>
                        <select id="category" name="category">
                            <option value="">Kategori SeÃ§in</option>
                            <option value="Matematik">Matematik</option>
                            <option value="Kimya">Kimya</option>
                            <option value="Bilgisayar Programlama">Bilgisayar Programlama</option>
                            <option value="Fizik">Fizik</option>
                            <option value="Ä°ngilizce">Ä°ngilizce</option>
                            <option value="Ä°statistik">Ä°statistik</option>
                            <option value="DiÄŸer">DiÄŸer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description">AÃ§Ä±klama</label>
                        <textarea id="description" name="description" rows="4"></textarea>
                    </div>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="applicationDeadline">ğŸ“… BaÅŸvuru Son Tarihi</label>
                            <input type="date" id="applicationDeadline" name="applicationDeadline" value="2026-06-30">
                        </div>
                        <div class="form-group">
                            <label for="startDate">ğŸ¯ BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" id="startDate" name="startDate" value="2026-07-01">
                        </div>
                        <div class="form-group">
                            <label for="endDate">ğŸ BitiÅŸ Tarihi</label>
                            <input type="date" id="endDate" name="endDate" value="2026-08-31">
                        </div>
                    </div>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="price">ğŸ’° Ãœcret (â‚º)</label>
                            <input type="number" id="price" name="price" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="quota">ğŸ‘¥ Kontenjan</label>
                            <input type="number" id="quota" name="quota" min="1" placeholder="30">
                        </div>
                        <div class="form-group">
                            <label for="language">ğŸŒ Ders Dili</label>
                            <select id="language" name="language">
                                <option value="turkish">TÃ¼rkÃ§e</option>
                                <option value="english">Ä°ngilizce</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn" id="submitCourseBtn">Ders Ekle</button>
                    <div id="courseFormMessage" class="form-message"></div>
                </form>
            </div>
        </div>
    </section>

    <!-- Dersler Section -->
    <section class="dersler-section">
        <div class="container">
            <div class="section-header">
                <h2 id="sectionTitle">PopÃ¼ler Dersler</h2>
                <p id="sectionSubtitle">En Ã§ok tercih edilen yaz dersleri</p>
            </div>
            
            <!-- Filtreleme Paneli (Sadece Ã¶ÄŸrenci ve ziyaretÃ§i iÃ§in) -->
            <div id="filterPanel" class="filter-panel" style="display: none;">
                <div class="filter-header">
                    <h3>ğŸ” Filtrele</h3>
                    <button onclick="toggleFilterPanel()" class="filter-toggle-btn">
                        <span id="filterToggleIcon">â–¼</span>
                    </button>
                </div>
                <div id="filterContent" class="filter-content">
                    <div class="filter-grid">
                        <!-- Ders AdÄ± Arama -->
                        <div class="filter-group">
                            <label for="filterCourseName">ğŸ“š Ders AdÄ±</label>
                            <input type="text" id="filterCourseName" placeholder="Ders adÄ± ara..." oninput="applyFilters()">
                        </div>
                        
                        <!-- Ãœniversite SeÃ§imi -->
                        <div class="filter-group">
                            <label for="filterUniversity">ğŸ›ï¸ Ãœniversite</label>
                            <select id="filterUniversity" onchange="applyFilters()">
                                <option value="">TÃ¼m Ãœniversiteler</option>
                            </select>
                        </div>
                        
                        <!-- Dil SeÃ§imi -->
                        <div class="filter-group">
                            <label for="filterLanguage">ğŸŒ Ders Dili</label>
                            <select id="filterLanguage" onchange="applyFilters()">
                                <option value="">TÃ¼m Diller</option>
                                <option value="turkish">TÃ¼rkÃ§e</option>
                                <option value="english">Ä°ngilizce</option>
                            </select>
                        </div>
                        
                        <!-- Min Ãœcret -->
                        <div class="filter-group">
                            <label for="filterMinPrice">ğŸ’° Min Ãœcret (â‚º)</label>
                            <input type="number" id="filterMinPrice" min="0" step="100" placeholder="0" oninput="applyFilters()">
                        </div>
                        
                        <!-- Max Ãœcret -->
                        <div class="filter-group">
                            <label for="filterMaxPrice">ğŸ’° Max Ãœcret (â‚º)</label>
                            <input type="number" id="filterMaxPrice" min="0" step="100" placeholder="SÄ±nÄ±rsÄ±z" oninput="applyFilters()">
                        </div>
                        
                        <!-- BaÅŸvuru BaÅŸlangÄ±Ã§ Tarihi -->
                        <div class="filter-group">
                            <label for="filterApplicationStartDate">ğŸ“… BaÅŸvuru BaÅŸlangÄ±Ã§</label>
                            <input type="date" id="filterApplicationStartDate" onchange="applyFilters()">
                        </div>
                        
                        <!-- BaÅŸvuru BitiÅŸ Tarihi -->
                        <div class="filter-group">
                            <label for="filterApplicationEndDate">ğŸ“… BaÅŸvuru BitiÅŸ</label>
                            <input type="date" id="filterApplicationEndDate" onchange="applyFilters()">
                        </div>
                        
                        <!-- Ders BaÅŸlangÄ±Ã§ Tarihi -->
                        <div class="filter-group">
                            <label for="filterStartDate">ğŸ¯ Ders BaÅŸlangÄ±Ã§</label>
                            <input type="date" id="filterStartDate" onchange="applyFilters()">
                        </div>
                        
                        <!-- Ders BitiÅŸ Tarihi -->
                        <div class="filter-group">
                            <label for="filterEndDate">ğŸ Ders BitiÅŸ</label>
                            <input type="date" id="filterEndDate" onchange="applyFilters()">
                        </div>
                    </div>
                    
                    <div class="filter-options">
                        <label class="filter-checkbox">
                            <input type="checkbox" id="filterHasAvailability" onchange="applyFilters()">
                            <span>Sadece kontenjanÄ± olan dersler</span>
                        </label>
                    </div>
                    
                    <div class="filter-actions">
                        <button onclick="clearFilters()" class="btn-clear-filters">ğŸ—‘ï¸ Filtreleri Temizle</button>
                        <span id="filterResultCount" class="filter-result-count"></span>
                    </div>
                </div>
            </div>
            
            <div id="loadingMessage" class="loading-message">YÃ¼kleniyor...</div>
            <div id="derslerGrid" class="dersler-grid">
                <!-- Dersler buraya dinamik olarak eklenecek -->
            </div>
        </div>
    </section>

    <!-- Ders Detay Modal -->
    <div id="courseDetailModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeCourseDetail()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeCourseDetail()">Ã—</button>
            <div id="modalBody" class="modal-body">
                <div class="loading-message">YÃ¼kleniyor...</div>
            </div>
        </div>
    </div>

    <!-- BaÅŸvurular Modal -->
    <div id="applicationsModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeApplicationsModal()"></div>
        <div class="modal-content" style="max-width: 900px;">
            <button class="modal-close" onclick="closeApplicationsModal()">Ã—</button>
            <div class="modal-body">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #dee2e6; padding-bottom: 15px;">
                    <button id="applicationsTabBtn" onclick="switchApplicationsTab('applications')" style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        ğŸ“ BaÅŸvurular
                    </button>
                    <button id="enrolledTabBtn" onclick="switchApplicationsTab('enrolled')" style="flex: 1; padding: 10px; background: #e9ecef; color: #495057; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                        ğŸ‘¥ KayÄ±tlÄ± Ã–ÄŸrenciler
                    </button>
                </div>
                
                <!-- BaÅŸvurular Tab -->
                <div id="applicationsTab" class="applications-tab">
                    <h2 style="margin-bottom: 20px;">ğŸ“‹ Ders BaÅŸvurularÄ±</h2>
                    <div id="applicationsList" class="applications-list">
                        <div class="loading-message">YÃ¼kleniyor...</div>
                    </div>
                </div>
                
                <!-- KayÄ±tlÄ± Ã–ÄŸrenciler Tab -->
                <div id="enrolledTab" class="applications-tab" style="display: none;">
                    <h2 style="margin-bottom: 20px;">ğŸ‘¥ KayÄ±tlÄ± Ã–ÄŸrenciler</h2>
                    <div id="enrolledStudentsList" class="applications-list">
                        <div class="loading-message">YÃ¼kleniyor...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ders DÃ¼zenleme Modal -->
    <div id="editCourseModal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeEditCourseModal()">Ã—</button>
            <div class="modal-body">
                <h2 style="margin-bottom: 20px;">Ders DÃ¼zenle</h2>
                <form id="editCourseForm" class="add-course-form">
                    <div class="form-group">
                        <label for="editCourseName">Ders AdÄ± *</label>
                        <input type="text" id="editCourseName" name="editCourseName" required>
                    </div>
                    <div class="form-group">
                        <label for="editCourseCode">Ders Kodu</label>
                        <input type="text" id="editCourseCode" name="editCourseCode">
                    </div>
                    <div class="form-group">
                        <label for="editCategory">Kategori</label>
                        <select id="editCategory" name="editCategory">
                            <option value="">Kategori SeÃ§in</option>
                            <option value="Matematik">Matematik</option>
                            <option value="Kimya">Kimya</option>
                            <option value="Bilgisayar Programlama">Bilgisayar Programlama</option>
                            <option value="Fizik">Fizik</option>
                            <option value="Ä°ngilizce">Ä°ngilizce</option>
                            <option value="Ä°statistik">Ä°statistik</option>
                            <option value="DiÄŸer">DiÄŸer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editDescription">AÃ§Ä±klama</label>
                        <textarea id="editDescription" name="editDescription" rows="4"></textarea>
                    </div>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="editApplicationDeadline">ğŸ“… BaÅŸvuru Son Tarihi</label>
                            <input type="date" id="editApplicationDeadline" name="editApplicationDeadline">
                        </div>
                        <div class="form-group">
                            <label for="editStartDate">ğŸ¯ BaÅŸlangÄ±Ã§ Tarihi</label>
                            <input type="date" id="editStartDate" name="editStartDate">
                        </div>
                        <div class="form-group">
                            <label for="editEndDate">ğŸ BitiÅŸ Tarihi</label>
                            <input type="date" id="editEndDate" name="editEndDate">
                        </div>
                    </div>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label for="editPrice">ğŸ’° Ãœcret (â‚º)</label>
                            <input type="number" id="editPrice" name="editPrice" min="0" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label for="editQuota">ğŸ‘¥ Kontenjan</label>
                            <input type="number" id="editQuota" name="editQuota" min="1" placeholder="30">
                        </div>
                        <div class="form-group">
                            <label for="editLanguage">ğŸŒ Ders Dili</label>
                            <select id="editLanguage" name="editLanguage">
                                <option value="turkish">TÃ¼rkÃ§e</option>
                                <option value="english">Ä°ngilizce</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editCourseLink">ğŸ”— Ders Linki (Udemy, YouTube, vb.)</label>
                        <input type="url" id="editCourseLink" name="editCourseLink" placeholder="https://www.udemy.com/course/...">
                        <small style="color: #666; font-size: 0.85rem;">Ã–ÄŸrenciler bu linke tÄ±klayarak ders iÃ§eriÄŸine eriÅŸebilir</small>
                    </div>
                    <div class="form-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="submit-btn" style="flex: 1;">Kaydet</button>
                        <button type="button" class="btn-secondary" onclick="closeEditCourseModal()" style="flex: 1; background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Ä°ptal</button>
                    </div>
                    <div id="editCourseFormMessage" class="form-message"></div>
                </form>
            </div>
        </div>
    </div>

    <style>
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f8f9fa;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 28px;
            line-height: 1;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-close:hover {
            background: #e9ecef;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 40px;
        }

        .course-detail-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: -40px -40px 30px -40px;
        }

        .course-detail-header h2 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .course-detail-header .course-code {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
        }

        .detail-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-section:last-child {
            border-bottom: none;
        }

        .detail-section h3 {
            color: #212529;
            margin: 0 0 15px 0;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .detail-item label {
            display: block;
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .detail-item value {
            display: block;
            color: #212529;
            font-size: 16px;
        }

        .academician-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
        }

        .academician-name {
            font-size: 20px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 10px;
        }

        .academician-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .academician-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #495057;
        }

        .academician-info-item strong {
            color: #212529;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-height: 95vh;
            }

            .modal-body {
                padding: 20px;
            }

            .course-detail-header {
                padding: 20px;
                margin: -20px -20px 20px -20px;
            }

            .detail-grid,
            .academician-info {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Campus Summer</h3>
                    <p>TÃ¼rkiye'nin en kapsamlÄ± yaz dersleri takip platformu. Akademik hedeflerinize ulaÅŸmanÄ±n en kolay yolu.</p>
                </div>
                <div class="footer-section">
                    <h3>HÄ±zlÄ± BaÄŸlantÄ±lar</h3>
                    <a href="../campusumer-anasayfa/anasayfa.html">Ana Sayfa</a>
                    <a href="../Ãœniversiteler/Ãœniversitler.html">Ãœniversiteler</a>
                    <a href="../Dersler/dersler.html">Dersler</a>
                    <a href="../HakkÄ±mÄ±zda/HakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a>
                </div>
                <div class="footer-section">
                    <h3>Destek</h3>                    
                    <a href="../Ä°letiÅŸim/iletisim.html">Ä°letiÅŸim</a>
                    <a href="../Gizlilik-politikasÄ±/gizlilikpolitikasÄ±.html">Gizlilik PolitikasÄ±</a>
                    
                </div>
                <div class="footer-section">
                    <h3>Ä°letiÅŸim</h3>
                    <p>ğŸ“§ atakan.baskir@std.hku.edu.tr</p>
                    <p>ğŸ“ +90 506 536 1780</p>
                    <p>ğŸ“ Gaziantep, TÃ¼rkiye</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Campus Summer. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = `${window.location.origin}/api`;
        
        // KullanÄ±cÄ± bilgilerini al
        let currentUser = null;
        let userToken = null;

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== SAYFA YÃœKLENÄ°YOR ===');
            
            // LocalStorage'dan kullanÄ±cÄ± bilgilerini al
            const userStr = localStorage.getItem('user');
            userToken = localStorage.getItem('token');
            
            console.log('LocalStorage user:', userStr);
            console.log('LocalStorage token:', userToken ? 'Var' : 'Yok');
            
            if (userStr && userToken) {
                try {
                    currentUser = JSON.parse(userStr);
                    console.log('âœ… KullanÄ±cÄ± giriÅŸi tespit edildi');
                    console.log('KullanÄ±cÄ± objesi:', currentUser);
                    console.log('User Type:', currentUser.userType);
                    console.log('User Type (alternatif):', currentUser.user_type);
                    
                    // EÄŸer userType yoksa user_type'Ä± kontrol et
                    if (!currentUser.userType && currentUser.user_type) {
                        currentUser.userType = currentUser.user_type;
                        console.log('user_type kullanÄ±ldÄ±, userType gÃ¼ncellendi:', currentUser.userType);
                    }
                    
                    initializePage();
                } catch (error) {
                    console.error('âŒ KullanÄ±cÄ± bilgisi parse edilemedi:', error);
                    console.log('Raw user string:', userStr);
                    // GiriÅŸ yapÄ±lmamÄ±ÅŸ gibi davran
                    console.log('ğŸ‘¤ ZiyaretÃ§i modu - Parse hatasÄ± nedeniyle');
                    document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                    document.getElementById('sectionSubtitle').textContent = 'Mevcut yaz dersleri';
                    document.getElementById('filterPanel').style.display = 'block';
                    // Filtre iÃ§eriÄŸini aÃ§Ä±k tut
                    const filterContent = document.getElementById('filterContent');
                    if (filterContent) {
                        filterContent.style.display = 'block';
                        document.getElementById('filterToggleIcon').textContent = 'â–²';
                    }
                    loadFilterOptions();
                    loadCourses();
                }
            } else {
                // GiriÅŸ yapÄ±lmamÄ±ÅŸsa, ziyaretÃ§i olarak tÃ¼m dersleri gÃ¶ster
                console.log('ğŸ‘¤ ZiyaretÃ§i modu - TÃ¼m dersler gÃ¶steriliyor');
                document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                document.getElementById('sectionSubtitle').textContent = 'Mevcut yaz dersleri';
                document.getElementById('filterPanel').style.display = 'block';
                // Filtre iÃ§eriÄŸini aÃ§Ä±k tut
                const filterContent = document.getElementById('filterContent');
                if (filterContent) {
                    filterContent.style.display = 'block';
                    document.getElementById('filterToggleIcon').textContent = 'â–²';
                }
                loadFilterOptions();
                loadCourses();
            }
        });

        async function initializePage() {
            console.log('=== SAYFA BAÅLATILIYOR ===');
            console.log('Current User:', currentUser);
            console.log('User Type:', currentUser ? currentUser.userType : 'null');
            
            if (!currentUser) {
                console.error('âŒ currentUser null!');
                alert('KullanÄ±cÄ± bilgisi bulunamadÄ±. LÃ¼tfen tekrar giriÅŸ yapÄ±n.');
                return;
            }

            // Ã–nce veritabanÄ± baÄŸlantÄ±sÄ±nÄ± test et
            try {
                console.log('VeritabanÄ± baÄŸlantÄ±sÄ± test ediliyor...');
                const healthCheck = await fetch(`${API_URL}/test/db`);
                const healthData = await healthCheck.json();
                if (!healthCheck.ok) {
                    console.error('VeritabanÄ± baÄŸlantÄ± hatasÄ±:', healthData);
                    alert('VeritabanÄ± baÄŸlantÄ± hatasÄ±! LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan ve veritabanÄ± ayarlarÄ±nÄ±n doÄŸru olduÄŸundan emin olun.');
                } else {
                    console.log('âœ… VeritabanÄ± baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±');
                }
            } catch (error) {
                console.error('Backend baÄŸlantÄ± hatasÄ±:', error);
                alert('Backend sunucusuna baÄŸlanÄ±lamadÄ±! LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.');
            }

            if (currentUser.userType === 'academician') {
                // Akademisyen arayÃ¼zÃ¼ - SADECE KENDÄ° DERSLERÄ°NÄ° GÃ–STER
                console.log('ğŸ“ Akademisyen modu aktif');
                document.getElementById('academicianSection').style.display = 'block';
                document.getElementById('sectionTitle').textContent = 'Benim Derslerim';
                document.getElementById('sectionSubtitle').textContent = 'Sadece sizin eklediÄŸiniz dersler gÃ¶sterilmektedir';
                setupAcademicianFeatures();
            } else if (currentUser.userType === 'student') {
                // Ã–ÄŸrenci arayÃ¼zÃ¼ - TÃœM DERSLERÄ° GÃ–STER
                console.log('ğŸ‘¨â€ğŸ“ Ã–ÄŸrenci modu aktif');
                document.getElementById('sectionTitle').textContent = 'TÃ¼m Dersler';
                document.getElementById('sectionSubtitle').textContent = 'Favorilerinize ekleyebileceÄŸiniz dersler';
                document.getElementById('filterPanel').style.display = 'block';
                // Filtre iÃ§eriÄŸini aÃ§Ä±k tut
                const filterContent = document.getElementById('filterContent');
                if (filterContent) {
                    filterContent.style.display = 'block';
                    const filterToggleIcon = document.getElementById('filterToggleIcon');
                    if (filterToggleIcon) {
                        filterToggleIcon.textContent = 'â–²';
                    }
                }
                setupStudentFeatures();
            } else {
                console.warn('âš ï¸ Bilinmeyen kullanÄ±cÄ± tipi:', currentUser.userType);
            }
            
            console.log('Dersler yÃ¼kleniyor...');
            loadCourses();
        }

        function setupAcademicianFeatures() {
            // Ders ekleme formu
            document.getElementById('addCourseForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                console.log('Ders ekleme baÅŸlÄ±yor...');
                console.log('Current User:', currentUser);
                console.log('Token:', userToken ? 'Var' : 'Yok');
                
                const formData = {
                    courseName: document.getElementById('courseName').value.trim(),
                    courseCode: document.getElementById('courseCode').value.trim() || null,
                    category: document.getElementById('category').value || null,
                    description: document.getElementById('description').value.trim() || null,
                    applicationDeadline: document.getElementById('applicationDeadline').value || null,
                    startDate: document.getElementById('startDate').value || null,
                    endDate: document.getElementById('endDate').value || null,
                    price: document.getElementById('price').value ? parseFloat(document.getElementById('price').value) : 0,
                    quota: document.getElementById('quota').value ? parseInt(document.getElementById('quota').value) : 30,
                    language: document.getElementById('language').value || 'turkish'
                };

                console.log('Form Data:', formData);

                try {
                    // Akademisyenin Ã¼niversite ID'sini al
                    const userUniversityId = currentUser.universityId;
                    if (!userUniversityId) {
                        alert('Ãœniversite bilgisi bulunamadÄ±. LÃ¼tfen profil ayarlarÄ±nÄ±zÄ± kontrol edin.');
                        return;
                    }

                    // summer_school_offerings endpoint'ine gÃ¶nder
                    const offeringData = {
                        courseName: formData.courseName,
                        courseCode: formData.courseCode || formData.courseName.substring(0, 6).toUpperCase(),
                        description: formData.description,
                        startDate: formData.startDate,
                        endDate: formData.endDate,
                        applicationDeadline: formData.applicationDeadline,
                        applicationStartDate: formData.startDate,
                        price: formData.price,
                        quota: formData.quota,
                        language: formData.language,
                        universityId: userUniversityId
                    };

                    const response = await fetch(`${API_URL}/summer-offerings`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userToken}`
                        },
                        body: JSON.stringify(offeringData)
                    });

                    const data = await response.json();
                    const messageDiv = document.getElementById('courseFormMessage');
                    
                    console.log('API Response:', { status: response.status, data });
                    
                    if (response.ok && data.success) {
                        messageDiv.textContent = 'âœ… Ders baÅŸarÄ±yla eklendi! Dersleriniz aÅŸaÄŸÄ±da gÃ¼ncelleniyor...';
                        messageDiv.className = 'form-message success';
                        messageDiv.style.display = 'block';
                        messageDiv.style.padding = '15px';
                        messageDiv.style.marginTop = '15px';
                        messageDiv.style.borderRadius = '8px';
                        messageDiv.style.backgroundColor = '#d4edda';
                        messageDiv.style.color = '#155724';
                        messageDiv.style.border = '1px solid #c3e6cb';
                        messageDiv.style.fontWeight = 'bold';
                        document.getElementById('addCourseForm').reset();
                        // Sadece kendi derslerini yÃ¼kle
                        setTimeout(() => {
                            messageDiv.style.display = 'none';
                            loadCourses();
                        }, 2000);
                    } else {
                        const errorMsg = data.message || `Hata: ${response.status} - ${response.statusText}`;
                        messageDiv.textContent = errorMsg;
                        messageDiv.className = 'form-message error';
                        messageDiv.style.display = 'block';
                        messageDiv.style.padding = '15px';
                        messageDiv.style.marginTop = '15px';
                        messageDiv.style.borderRadius = '8px';
                        messageDiv.style.backgroundColor = '#f8d7da';
                        messageDiv.style.color = '#721c24';
                        messageDiv.style.border = '1px solid #f5c6cb';
                        console.error('API Error:', data);
                    }
                } catch (error) {
                    console.error('Ders ekleme hatasÄ±:', error);
                    const messageDiv = document.getElementById('courseFormMessage');
                    messageDiv.textContent = `Sunucuya baÄŸlanÄ±lamadÄ±: ${error.message}`;
                    messageDiv.className = 'form-message error';
                    messageDiv.style.display = 'block';
                    messageDiv.style.padding = '15px';
                    messageDiv.style.marginTop = '15px';
                    messageDiv.style.borderRadius = '8px';
                    messageDiv.style.backgroundColor = '#f8d7da';
                    messageDiv.style.color = '#721c24';
                    messageDiv.style.border = '1px solid #f5c6cb';
                }
            });
        }

        function setupStudentFeatures() {
            // Ã–ÄŸrenci iÃ§in Ã¶zel bir ÅŸey yapmaya gerek yok, favori butonlarÄ± loadCourses iÃ§inde eklenecek
            loadFilterOptions();
        }
        
        // Filtreleme seÃ§eneklerini yÃ¼kle (Ã¼niversiteler)
        async function loadFilterOptions() {
            try {
                const universitySelect = document.getElementById('filterUniversity');
                
                // EÄŸer zaten yÃ¼klenmiÅŸse tekrar yÃ¼kleme
                if (universitySelect && universitySelect.options.length > 1) {
                    console.log('Ãœniversiteler zaten yÃ¼klenmiÅŸ');
                    return;
                }
                
                // Ãœniversiteleri yÃ¼kle (herkese aÃ§Ä±k endpoint)
                console.log('Ãœniversiteler yÃ¼kleniyor...');
                const uniResponse = await fetch(`${API_URL}/universities`);
                
                if (!uniResponse.ok) {
                    throw new Error(`HTTP ${uniResponse.status}: ${uniResponse.statusText}`);
                }
                
                const uniData = await uniResponse.json();
                console.log('Ãœniversite verisi:', uniData);
                
                if (universitySelect && uniData.success && uniData.universities && Array.isArray(uniData.universities)) {
                    // Mevcut seÃ§enekleri temizle (sadece "TÃ¼m Ãœniversiteler" kalacak)
                    while (universitySelect.options.length > 1) {
                        universitySelect.remove(1);
                    }
                    
                    // Ãœniversiteleri ekle
                    uniData.universities.forEach(uni => {
                        const option = document.createElement('option');
                        option.value = uni.id;
                        option.textContent = `${uni.name}${uni.city ? ' - ' + uni.city : ''}`;
                        universitySelect.appendChild(option);
                    });
                    
                    console.log(`âœ… ${uniData.universities.length} Ã¼niversite yÃ¼klendi`);
                } else {
                    console.warn('âš ï¸ Ãœniversite verisi beklenen formatta deÄŸil:', uniData);
                }
            } catch (error) {
                console.error('âŒ Filtre seÃ§enekleri yÃ¼kleme hatasÄ±:', error);
                // Hata durumunda kullanÄ±cÄ±ya bilgi ver
                const universitySelect = document.getElementById('filterUniversity');
                if (universitySelect) {
                    const errorOption = document.createElement('option');
                    errorOption.value = '';
                    errorOption.textContent = 'Ãœniversiteler yÃ¼klenemedi';
                    errorOption.disabled = true;
                    universitySelect.appendChild(errorOption);
                }
            }
        }
        
        // Filtre panelini aÃ§/kapat
        function toggleFilterPanel() {
            const filterContent = document.getElementById('filterContent');
            const filterToggleIcon = document.getElementById('filterToggleIcon');
            
            if (filterContent.style.display === 'none' || !filterContent.style.display) {
                filterContent.style.display = 'block';
                filterToggleIcon.textContent = 'â–²';
            } else {
                filterContent.style.display = 'none';
                filterToggleIcon.textContent = 'â–¼';
            }
        }
        
        // Filtreleri uygula (debounce ile)
        let filterTimeout;
        function applyFilters() {
            clearTimeout(filterTimeout);
            filterTimeout = setTimeout(() => {
                console.log('Filtreler uygulanÄ±yor...');
                loadCourses();
            }, 300); // 300ms debounce
        }
        
        // Filtreleri temizle
        function clearFilters() {
            document.getElementById('filterCourseName').value = '';
            document.getElementById('filterUniversity').value = '';
            document.getElementById('filterLanguage').value = '';
            document.getElementById('filterMinPrice').value = '';
            document.getElementById('filterMaxPrice').value = '';
            document.getElementById('filterApplicationStartDate').value = '';
            document.getElementById('filterApplicationEndDate').value = '';
            document.getElementById('filterStartDate').value = '';
            document.getElementById('filterEndDate').value = '';
            document.getElementById('filterHasAvailability').checked = false;
            loadCourses();
        }
        
        // URL'e filtre parametrelerini ekle
        function addFiltersToUrl(baseUrl) {
            const params = new URLSearchParams();
            
            const courseName = document.getElementById('filterCourseName')?.value.trim();
            const universityId = document.getElementById('filterUniversity')?.value;
            const language = document.getElementById('filterLanguage')?.value;
            const minPrice = document.getElementById('filterMinPrice')?.value;
            const maxPrice = document.getElementById('filterMaxPrice')?.value;
            const applicationStartDate = document.getElementById('filterApplicationStartDate')?.value;
            const applicationEndDate = document.getElementById('filterApplicationEndDate')?.value;
            const startDate = document.getElementById('filterStartDate')?.value;
            const endDate = document.getElementById('filterEndDate')?.value;
            const hasAvailability = document.getElementById('filterHasAvailability')?.checked;
            
            if (courseName) params.append('search', courseName);
            if (universityId) params.append('universityId', universityId);
            if (language) params.append('language', language);
            if (minPrice) params.append('minPrice', minPrice);
            if (maxPrice) params.append('maxPrice', maxPrice);
            if (applicationStartDate) params.append('applicationStartDate', applicationStartDate);
            if (applicationEndDate) params.append('applicationEndDate', applicationEndDate);
            if (startDate) params.append('startDate', startDate);
            if (endDate) params.append('endDate', endDate);
            if (hasAvailability) params.append('hasAvailability', 'true');
            
            const queryString = params.toString();
            return queryString ? `${baseUrl}?${queryString}` : baseUrl;
        }
        
        // Filtre sonuÃ§ sayÄ±sÄ±nÄ± gÃ¼ncelle
        function updateFilterResultCount(count) {
            const resultCount = document.getElementById('filterResultCount');
            if (resultCount) {
                if (count > 0) {
                    resultCount.textContent = `ğŸ“Š ${count} ders bulundu`;
                    resultCount.style.display = 'inline-block';
                } else {
                    resultCount.textContent = '';
                    resultCount.style.display = 'none';
                }
            }
        }

        async function loadCourses() {
            const loadingDiv = document.getElementById('loadingMessage');
            const gridDiv = document.getElementById('derslerGrid');
            
            console.log('=== DERSLER YÃœKLENÄ°YOR ===');
            console.log('Current User:', currentUser);
            console.log('User Type:', currentUser ? currentUser.userType : 'null');
            console.log('User Token:', userToken ? 'Var' : 'Yok');
            console.log('API URL:', API_URL);
            
            loadingDiv.style.display = 'block';
            gridDiv.innerHTML = '';

            try {
                let url = `${API_URL}/courses`;
                let headers = { 'Content-Type': 'application/json' };

                // EÄŸer akademisyen ise, SADECE kendi derslerini getir
                if (currentUser && currentUser.userType === 'academician') {
                    url = `${API_URL}/summer-offerings/my/offerings`;
                    headers['Authorization'] = `Bearer ${userToken}`;
                    console.log('ğŸ“ AKADEMÄ°SYEN: Sadece kendi dersleriniz yÃ¼kleniyor:', url);
                } else if (currentUser && currentUser.userType === 'student') {
                    // Ã–ÄŸrenci iÃ§in summer-offerings endpoint'i kullan (tÃ¼m aktif dersler + filtreler)
                    url = `${API_URL}/summer-offerings`;
                    url = addFiltersToUrl(url);
                    console.log('ğŸ‘¨â€ğŸ“ Ã–ÄRENCÄ°: TÃ¼m dersler yÃ¼kleniyor');
                    console.log('URL:', url);
                } else {
                    url = `${API_URL}/summer-offerings`;
                    url = addFiltersToUrl(url);
                    console.log('ğŸ‘¤ ZÄ°YARETÃ‡Ä°: TÃ¼m dersler yÃ¼kleniyor');
                    console.log('URL:', url);
                }

                console.log('Fetching from:', url);
                console.log('Headers:', headers);
                console.log('Filtre parametreleri:', url.includes('?') ? url.split('?')[1] : 'Yok');
                
                const response = await fetch(url, { headers });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    let errorMessage = `API hatasÄ±: ${response.status} - ${response.statusText}`;
                    let errorDetail = '';
                    
                    try {
                        const errorData = await response.json();
                        console.error('API yanÄ±t hatasÄ± (JSON):', errorData);
                        if (errorData.message) {
                            errorMessage = errorData.message;
                        }
                        if (errorData.error) {
                            errorDetail = typeof errorData.error === 'string' 
                                ? errorData.error 
                                : JSON.stringify(errorData.error);
                        }
                    } catch (parseError) {
                        const errorText = await response.text();
                        console.error('API yanÄ±t hatasÄ± (Text):', errorText);
                        errorDetail = errorText.substring(0, 200); // Ä°lk 200 karakter
                    }
                    
                    console.error('Hata detayÄ±:', errorDetail);
                    
                    // 500 hatasÄ± iÃ§in Ã¶zel mesaj
                    if (response.status === 500) {
                        throw new Error(`Backend sunucu hatasÄ± (500). LÃ¼tfen backend konsolunu kontrol edin. ${errorDetail ? '\nDetay: ' + errorDetail : ''}`);
                    } else {
                        throw new Error(errorMessage + (errorDetail ? '\n' + errorDetail : ''));
                    }
                }
                
                const data = await response.json();
                console.log('Raw API Response:', data);
                console.log('data.success:', data.success);
                
                // Response formatÄ±nÄ± kontrol et (summer-offerings endpoint'i data veya courses dÃ¶ndÃ¼rebilir)
                let courses = null;
                if (data.success) {
                    if (data.data && Array.isArray(data.data)) {
                        courses = data.data;
                    } else if (data.courses && Array.isArray(data.courses)) {
                        courses = data.courses;
                    } else if (Array.isArray(data)) {
                        courses = data;
                    }
                }
                
                console.log('courses type:', typeof courses);
                console.log('courses:', courses);
                console.log('courses length:', courses ? courses.length : 'null');

                if (data.success && courses && Array.isArray(courses)) {
                    console.log('âœ… Toplam ders sayÄ±sÄ±:', courses.length);
                    // Filtre sonuÃ§ sayÄ±sÄ±nÄ± gÃ¼ncelle
                    updateFilterResultCount(courses.length);
                    if (courses.length === 0) {
                        console.warn('âš ï¸ HiÃ§ ders bulunamadÄ±!');
                        const emptyMessage = currentUser && currentUser.userType === 'academician' 
                            ? '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklememiÅŸsiniz. YukarÄ±daki formdan ders ekleyebilirsiniz.</p>'
                            : '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">Filtre kriterlerinize uygun ders bulunamadÄ±. LÃ¼tfen filtreleri deÄŸiÅŸtirip tekrar deneyin.</p>';
                        gridDiv.innerHTML = emptyMessage;
                    } else {
                        console.log('âœ… Dersler gÃ¶steriliyor...');
                        displayCourses(courses);
                    }
                } else {
                    console.error('âŒ Ders verisi hatalÄ± formatta:', data);
                    gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545; padding: 2rem;">Ders verisi hatalÄ± formatta. Konsolu kontrol edin.</p>';
                }
            } catch (error) {
                console.error('âŒ Ders yÃ¼kleme hatasÄ±:', error);
                console.error('Hata detayÄ±:', error.message);
                console.error('Stack trace:', error.stack);
                gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545; padding: 2rem;">Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message + '<br><small>LÃ¼tfen backend sunucusunun Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.</small></p>';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        async function displayCourses(courses) {
            const gridDiv = document.getElementById('derslerGrid');
            
            console.log('displayCourses Ã§aÄŸrÄ±ldÄ±, courses:', courses);
            
            // GÃ¼venlik kontrolÃ¼
            if (!courses || !Array.isArray(courses)) {
                console.error('Courses geÃ§erli bir array deÄŸil:', courses);
                gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">Ders verisi hatalÄ±</p>';
                return;
            }
            
            if (courses.length === 0) {
                gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklenmemiÅŸ</p>';
                return;
            }

            // Kategori ikonlarÄ±
            const categoryIcons = {
                'Matematik': 'ğŸ“',
                'Kimya': 'ğŸ§ª',
                'Bilgisayar Programlama': 'ğŸ’»',
                'Fizik': 'âš¡',
                'Ä°ngilizce': 'ğŸŒ',
                'Ä°statistik': 'ğŸ“Š',
                'DiÄŸer': 'ğŸ“š'
            };

            for (const course of courses) {
                const card = document.createElement('div');
                card.className = 'ders-card';
                card.dataset.courseId = course.id;

                const icon = categoryIcons[course.category] || 'ğŸ“š';
                const isMyCourse = currentUser && currentUser.userType === 'academician';
                const isStudent = currentUser && currentUser.userType === 'student';

                // Tarih formatlama
                const formatDate = (dateStr) => {
                    if (!dateStr) return 'BelirtilmemiÅŸ';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
                };

                const deadlineDate = course.application_deadline ? new Date(course.application_deadline) : null;
                const today = new Date();
                const isExpired = deadlineDate && deadlineDate < today;

                card.innerHTML = `
                    <div class="ders-icon">
                        <span>${icon}</span>
                    </div>
                    <h3>${course.course_name}</h3>
                    ${course.course_code ? `<p class="course-code">${course.course_code}</p>` : ''}
                    ${isMyCourse ? `<p style="color: #28a745; font-weight: bold; font-size: 0.9em; margin: 5px 0;">âœ“ Sizin Dersiniz</p>` : ''}
                    ${isExpired ? `<p style="color: #dc3545; font-weight: bold; font-size: 0.9em; margin: 5px 0;">âš ï¸ BaÅŸvuru SÃ¼resi GeÃ§miÅŸ</p>` : ''}
                    <p>${course.description || 'AÃ§Ä±klama bulunmuyor'}</p>
                    ${course.application_deadline ? `
                        <div class="course-dates" style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em;">
                            <p style="margin: 5px 0;"><strong>ğŸ“… BaÅŸvuru Son:</strong> ${formatDate(course.application_deadline)}</p>
                            ${course.start_date ? `<p style="margin: 5px 0;"><strong>ğŸ¯ BaÅŸlangÄ±Ã§:</strong> ${formatDate(course.start_date)}</p>` : ''}
                            ${course.end_date ? `<p style="margin: 5px 0;"><strong>ğŸ BitiÅŸ:</strong> ${formatDate(course.end_date)}</p>` : ''}
                        </div>
                    ` : ''}
                    ${course.university_name ? `
                        <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em;">
                            <strong style="color: #1976d2;">ğŸ›ï¸ ${course.university_name}${course.university_city ? ' - ' + course.university_city : ''}</strong>
                        </div>
                    ` : ''}
                    <div class="ders-stats">
                        <span class="stat-item">ğŸ‘¥ ${course.student_count || course.current_registrations || 0} Ã–ÄŸrenci</span>
                    </div>
                    <div class="course-info" style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 0.9em; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                        ${course.price !== undefined && course.price !== null ? `
                            <div style="text-align: center;">
                                <strong style="display: block; color: #28a745; font-size: 1.1em;">ğŸ’° ${parseFloat(course.price).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} â‚º</strong>
                                <span style="color: #666; font-size: 0.85em;">Ãœcret</span>
                            </div>
                        ` : ''}
                        ${course.quota !== undefined && course.quota !== null ? `
                            <div style="text-align: center;">
                                <strong style="display: block; color: #667eea; font-size: 1.1em;">ğŸ‘¥ ${course.quota}</strong>
                                <span style="color: #666; font-size: 0.85em;">Kontenjan</span>
                            </div>
                        ` : ''}
                        ${course.language ? `
                            <div style="text-align: center;">
                                <strong style="display: block; color: #764ba2; font-size: 1.1em;">ğŸŒ ${course.language === 'turkish' ? 'TÃ¼rkÃ§e' : course.language === 'english' ? 'Ä°ngilizce' : course.language}</strong>
                                <span style="color: #666; font-size: 0.85em;">Dil</span>
                            </div>
                        ` : ''}
                    </div>
                    ${!isMyCourse && course.academician_name ? `<p class="academician-name">Ã–ÄŸretmen: ${course.academician_title ? course.academician_title + ' ' : ''}${course.academician_name}</p>` : ''}
                    <div class="course-actions" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        ${isMyCourse ? `
                            <button class="edit-btn" onclick="editCourse(${course.id})" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; min-width: 120px;">âœï¸ DÃ¼zenle</button>
                            <button class="delete-btn" onclick="deleteCourse(${course.id})" style="background: #dc3545; flex: 1; min-width: 120px;">ğŸ—‘ï¸ Dersi Sil</button>
                        ` : ''}
                        ${isStudent && !isExpired ? `
                            <button class="favorite-btn" id="fav-${course.id}" onclick="toggleFavorite(${course.id})" style="flex: 1; min-width: 150px;">
                                <span class="fav-icon">â™¡</span> Favoriye Ekle
                            </button>
                            <button class="apply-btn" onclick="applyToCourse(${course.id})" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; min-width: 120px;">
                                ğŸ“ BaÅŸvur
                            </button>
                        ` : ''}
                        ${isStudent && isExpired ? `
                            <button class="favorite-btn" disabled style="opacity: 0.5; cursor: not-allowed; flex: 1; min-width: 150px;">
                                â° BaÅŸvuru SÃ¼resi Doldu
                            </button>
                        ` : ''}
                        ${isMyCourse ? `
                            <button class="applications-btn" onclick="showCourseApplications(${course.id})" style="background: #ffc107; color: #212529; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; min-width: 120px;">
                                ğŸ“‹ BaÅŸvurular
                            </button>
                        ` : ''}
                        <button class="detail-btn" onclick="showCourseDetail(${course.id})" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; flex: 1; min-width: 120px;">
                            ğŸ“‹ Detay GÃ¶r
                        </button>
                    </div>
                `;

                gridDiv.appendChild(card);

                // Ã–ÄŸrenci ise favori durumunu kontrol et
                if (isStudent) {
                    checkFavoriteStatus(course.id);
                }
            }
        }

        // Ders dÃ¼zenleme modalÄ±nÄ± aÃ§
        async function editCourse(courseId) {
            try {
                console.log('Ders dÃ¼zenleniyor, ID:', courseId);
                
                // Ders bilgilerini getir (summer_school_offerings endpoint'inden)
                const response = await fetch(`${API_URL}/summer-offerings/${courseId}`);
                
                if (!response.ok) {
                    throw new Error('Ders bilgileri yÃ¼klenemedi');
                }
                
                const data = await response.json();
                
                if (!data.success || !data.data) {
                    throw new Error('Ders bulunamadÄ±');
                }
                
                const course = data.data;
                
                // Form alanlarÄ±nÄ± doldur
                document.getElementById('editCourseName').value = course.course_name || '';
                document.getElementById('editCourseCode').value = course.course_code || '';
                document.getElementById('editCategory').value = course.category || '';
                document.getElementById('editDescription').value = course.description || '';
                
                // Tarihleri formatla (YYYY-MM-DD)
                const formatDateForInput = (dateStr) => {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    return date.toISOString().split('T')[0];
                };
                
                document.getElementById('editApplicationDeadline').value = formatDateForInput(course.application_deadline);
                document.getElementById('editStartDate').value = formatDateForInput(course.start_date);
                document.getElementById('editEndDate').value = formatDateForInput(course.end_date);
                
                document.getElementById('editPrice').value = course.price || 0;
                document.getElementById('editQuota').value = course.quota || 30;
                document.getElementById('editLanguage').value = course.language || 'turkish';
                document.getElementById('editCourseLink').value = course.udemy_link || '';
                
                // Modal'Ä± gÃ¶ster
                document.getElementById('editCourseModal').style.display = 'flex';
                
                // Form submit handler'Ä± ekle (sadece bir kez)
                const editForm = document.getElementById('editCourseForm');
                const existingHandler = editForm.getAttribute('data-handler-attached');
                if (!existingHandler) {
                    editForm.setAttribute('data-handler-attached', 'true');
                    editForm.onsubmit = async (e) => {
                        e.preventDefault();
                        await updateCourse(courseId);
                    };
                }
                
            } catch (error) {
                console.error('Ders dÃ¼zenleme hatasÄ±:', error);
                alert('Ders bilgileri yÃ¼klenirken bir hata oluÅŸtu: ' + error.message);
            }
        }

        // Ders gÃ¼ncelle
        async function updateCourse(courseId) {
            try {
                const formData = {
                    courseName: document.getElementById('editCourseName').value.trim(),
                    courseCode: document.getElementById('editCourseCode').value.trim() || null,
                    category: document.getElementById('editCategory').value || null,
                    description: document.getElementById('editDescription').value.trim() || null,
                    applicationDeadline: document.getElementById('editApplicationDeadline').value || null,
                    startDate: document.getElementById('editStartDate').value || null,
                    endDate: document.getElementById('editEndDate').value || null,
                    price: document.getElementById('editPrice').value ? parseFloat(document.getElementById('editPrice').value) : null,
                    quota: document.getElementById('editQuota').value ? parseInt(document.getElementById('editQuota').value) : null,
                    language: document.getElementById('editLanguage').value || null,
                    udemyLink: document.getElementById('editCourseLink').value.trim() || null
                };

                console.log('Ders gÃ¼ncelleniyor:', formData);

                // summer_school_offerings endpoint'ine gÃ¶nder
                const offeringData = {
                    courseName: formData.courseName,
                    courseCode: formData.courseCode,
                    description: formData.description,
                    startDate: formData.startDate,
                    endDate: formData.endDate,
                    applicationDeadline: formData.applicationDeadline,
                    price: formData.price,
                    quota: formData.quota,
                    language: formData.language,
                    udemyLink: formData.udemyLink
                };

                const response = await fetch(`${API_URL}/summer-offerings/${courseId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify(offeringData)
                });

                const data = await response.json();
                const messageDiv = document.getElementById('editCourseFormMessage');
                
                console.log('API Response:', { status: response.status, data });
                
                if (response.ok && data.success) {
                    messageDiv.textContent = 'âœ… Ders baÅŸarÄ±yla gÃ¼ncellendi!';
                    messageDiv.className = 'form-message success';
                    messageDiv.style.display = 'block';
                    messageDiv.style.padding = '15px';
                    messageDiv.style.marginTop = '15px';
                    messageDiv.style.borderRadius = '8px';
                    messageDiv.style.backgroundColor = '#d4edda';
                    messageDiv.style.color = '#155724';
                    messageDiv.style.border = '1px solid #c3e6cb';
                    messageDiv.style.fontWeight = 'bold';
                    
                    setTimeout(() => {
                        closeEditCourseModal();
                        loadCourses(); // Listeyi yenile
                    }, 1500);
                } else {
                    const errorMsg = data.message || `Hata: ${response.status} - ${response.statusText}`;
                    messageDiv.textContent = errorMsg;
                    messageDiv.className = 'form-message error';
                    messageDiv.style.display = 'block';
                    messageDiv.style.padding = '15px';
                    messageDiv.style.marginTop = '15px';
                    messageDiv.style.borderRadius = '8px';
                    messageDiv.style.backgroundColor = '#f8d7da';
                    messageDiv.style.color = '#721c24';
                    messageDiv.style.border = '1px solid #f5c6cb';
                    console.error('API Error:', data);
                }
            } catch (error) {
                console.error('Ders gÃ¼ncelleme hatasÄ±:', error);
                const messageDiv = document.getElementById('editCourseFormMessage');
                messageDiv.textContent = `Sunucuya baÄŸlanÄ±lamadÄ±: ${error.message}`;
                messageDiv.className = 'form-message error';
                messageDiv.style.display = 'block';
                messageDiv.style.padding = '15px';
                messageDiv.style.marginTop = '15px';
                messageDiv.style.borderRadius = '8px';
                messageDiv.style.backgroundColor = '#f8d7da';
                messageDiv.style.color = '#721c24';
                messageDiv.style.border = '1px solid #f5c6cb';
            }
        }

        // DÃ¼zenleme modalÄ±nÄ± kapat
        function closeEditCourseModal() {
            document.getElementById('editCourseModal').style.display = 'none';
            document.getElementById('editCourseForm').reset();
            document.getElementById('editCourseFormMessage').textContent = '';
            document.getElementById('editCourseFormMessage').style.display = 'none';
        }

        async function deleteCourse(courseId) {
            if (!confirm('âš ï¸ Bu dersi kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!')) {
                return;
            }

                try {
                    console.log('Ders siliniyor, ID:', courseId);
                const response = await fetch(`${API_URL}/summer-offerings/${courseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // Dersi DOM'dan kaldÄ±r
                    const card = document.querySelector(`[data-course-id="${courseId}"]`);
                    if (card) {
                        // Animasyonlu silme
                        card.style.opacity = '0';
                        card.style.transform = 'scale(0.8)';
                        card.style.transition = 'all 0.3s ease';
                        setTimeout(() => {
                            card.remove();
                            // EÄŸer hiÃ§ ders kalmadÄ±ysa mesaj gÃ¶ster
                            const remainingCourses = document.querySelectorAll('.ders-card');
                            if (remainingCourses.length === 0) {
                                document.getElementById('derslerGrid').innerHTML = 
                                    '<p style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">HenÃ¼z ders eklememiÅŸsiniz. YukarÄ±daki formdan ders ekleyebilirsiniz.</p>';
                            }
                        }, 300);
                    }
                    alert('âœ… Ders baÅŸarÄ±yla silindi!');
                    console.log('Ders baÅŸarÄ±yla silindi');
                } else {
                    alert('âŒ Hata: ' + (data.message || 'Ders silinirken bir hata oluÅŸtu'));
                    console.error('Ders silme hatasÄ±:', data);
                }
            } catch (error) {
                console.error('Ders silme hatasÄ±:', error);
                alert('âŒ Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message);
            }
        }

        async function toggleFavorite(courseId) {
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }

            const favBtn = document.getElementById(`fav-${courseId}`);
            const favIcon = favBtn.querySelector('.fav-icon');
            const isFavorite = favIcon.textContent === 'â™¥';

            try {
                if (isFavorite) {
                    // Favoriden Ã§Ä±kar
                    const response = await fetch(`${API_URL}/favorites/${courseId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${userToken}`
                        }
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        favIcon.textContent = 'â™¡';
                        favBtn.innerHTML = '<span class="fav-icon">â™¡</span> Favoriye Ekle';
                        updateStudentCount(courseId, -1);
                    } else {
                        alert(data.message || 'Favoriden Ã§Ä±karÄ±lÄ±rken bir hata oluÅŸtu');
                    }
                } else {
                    // Favoriye ekle
                    const response = await fetch(`${API_URL}/favorites`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userToken}`
                        },
                        body: JSON.stringify({ courseId })
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        favIcon.textContent = 'â™¥';
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                        updateStudentCount(courseId, 1);
                    } else {
                        alert(data.message || 'Favoriye eklenirken bir hata oluÅŸtu');
                    }
                }
            } catch (error) {
                console.error('Favori iÅŸlemi hatasÄ±:', error);
                alert('Sunucuya baÄŸlanÄ±lamadÄ±');
            }
        }

        async function checkFavoriteStatus(courseId) {
            if (!userToken) return;

            try {
                const response = await fetch(`${API_URL}/favorites/check/${courseId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success && data.isFavorite) {
                    const favBtn = document.getElementById(`fav-${courseId}`);
                    if (favBtn) {
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                    }
                }
            } catch (error) {
                console.error('Favori durumu kontrol hatasÄ±:', error);
            }
        }

        function updateStudentCount(courseId, change) {
            const card = document.querySelector(`[data-course-id="${courseId}"]`);
            if (!card) return;

            const statItem = card.querySelector('.stat-item:last-child');
            if (statItem) {
                const currentText = statItem.textContent;
                const match = currentText.match(/(\d+)/);
                if (match) {
                    const currentCount = parseInt(match[1]);
                    const newCount = Math.max(0, currentCount + change);
                    statItem.textContent = `ğŸ‘¥ ${newCount} Ã–ÄŸrenci`;
                }
            }
        }

        // Ders detayÄ±nÄ± gÃ¶ster
        async function showCourseDetail(courseId) {
            const modal = document.getElementById('courseDetailModal');
            const modalBody = document.getElementById('modalBody');
            
            // Modal'Ä± gÃ¶ster ve loading state
            modal.style.display = 'flex';
            modalBody.innerHTML = '<div class="loading-message" style="text-align: center; padding: 40px;">YÃ¼kleniyor...</div>';
            
            try {
                console.log('Ders detayÄ± yÃ¼kleniyor, ID:', courseId);
                // summer-offerings endpoint'ini kullan
                const response = await fetch(`${API_URL}/summer-offerings/${courseId}`);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Ders detaylarÄ± yÃ¼klenemedi');
                }
                
                const data = await response.json();
                console.log('Ders detayÄ±:', data);
                
                // Response formatÄ±nÄ± kontrol et (summer-offerings endpoint'i data dÃ¶ndÃ¼rÃ¼r)
                const course = data.success && data.data ? data.data : (data.course || null);
                
                if (course) {
                    displayCourseDetail(course);
                } else {
                    modalBody.innerHTML = '<div class="error-message" style="text-align: center; padding: 40px; color: #dc3545;">Ders detaylarÄ± yÃ¼klenemedi</div>';
                }
            } catch (error) {
                console.error('Ders detay hatasÄ±:', error);
                modalBody.innerHTML = '<div class="error-message" style="text-align: center; padding: 40px; color: #dc3545;">Hata: ' + error.message + '</div>';
            }
        }

        // Ders detayÄ±nÄ± gÃ¶ster
        function displayCourseDetail(course) {
            const modalBody = document.getElementById('modalBody');
            
            const formatDate = (dateStr) => {
                if (!dateStr) return 'BelirtilmemiÅŸ';
                const date = new Date(dateStr);
                return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
            };

            const formatPrice = (price) => {
                if (!price || price == 0) return 'Ãœcretsiz';
                return `â‚º${parseFloat(price).toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            };

            // Akademisyen bilgileri
            let academicianHTML = '';
            // Backend'den academician_name, academician_email ve academician_title geliyor
            const academicianTitle = course.academician_title || course.academician?.title || '';
            const academicianName = course.academician_name || course.academician?.full_name || '';
            const academicianEmail = course.academician_email || course.academician?.email || '';
            
            if (academicianName || academicianEmail) {
                academicianHTML = `
                    <div class="detail-section">
                        <h3>ğŸ‘¨â€ğŸ« Dersi Veren Akademisyen</h3>
                        <div class="academician-card">
                            <div class="academician-name">
                                ${academicianTitle ? `<span style="font-weight: 600; color: #667eea;">${academicianTitle}</span> ` : ''}${academicianName || 'BelirtilmemiÅŸ'}
                            </div>
                            <div class="academician-info">
                                ${academicianEmail ? `
                                    <div class="academician-info-item">
                                        <span>ğŸ“§</span>
                                        <div>
                                            <strong>E-posta:</strong><br>
                                            <a href="mailto:${academicianEmail}" style="color: #667eea; text-decoration: none; font-weight: 600;">${academicianEmail}</a>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            modalBody.innerHTML = `
                <div class="course-detail-header">
                    <h2>${course.course_name}</h2>
                    ${course.course_code ? `<span class="course-code">${course.course_code}</span>` : ''}
                    ${course.category ? `<span class="course-code" style="margin-left: 10px;">ğŸ“š ${course.category}</span>` : ''}
                </div>

                <div class="detail-section">
                    <h3>ğŸ“ Ders HakkÄ±nda</h3>
                    <p style="line-height: 1.6; color: #495057;">${course.description || 'AÃ§Ä±klama bulunmuyor.'}</p>
                </div>

                <div class="detail-section">
                    <h3>ğŸ’° Ders Bilgileri</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <label>ğŸ’µ Ãœcret</label>
                            <value style="font-size: 20px; font-weight: bold; color: #28a745;">${formatPrice(course.price)}</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“ Kredi</label>
                            <value>${course.credits || 3} Kredi</value>
                        </div>
                        <div class="detail-item">
                            <label>â° Ders Saati</label>
                            <value>${course.course_hours || 42} Saat</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ‘¥ Kontenjan</label>
                            <value>${course.quota || 30} KiÅŸi</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“Š KayÄ±tlÄ± Ã–ÄŸrenci</label>
                            <value style="color: #667eea; font-weight: bold;">${course.student_count || course.current_registrations || 0} Ã–ÄŸrenci</value>
                        </div>
                        <div class="detail-item">
                            <label>ğŸ“ˆ Doluluk OranÄ±</label>
                            <value>${course.quota ? Math.round((course.student_count || course.current_registrations || 0) / course.quota * 100) : 0}%</value>
                        </div>
                        ${course.language ? `
                        <div class="detail-item">
                            <label>ğŸŒ Ders Dili</label>
                            <value style="color: #764ba2; font-weight: bold;">${course.language === 'turkish' ? 'TÃ¼rkÃ§e' : course.language === 'english' ? 'Ä°ngilizce' : course.language}</value>
                        </div>
                        ` : ''}
                    </div>
                </div>

                ${course.application_deadline || course.start_date || course.end_date ? `
                    <div class="detail-section">
                        <h3>ğŸ“… Ã–nemli Tarihler</h3>
                        <div class="detail-grid">
                            ${course.application_deadline ? `
                                <div class="detail-item">
                                    <label>ğŸ“ BaÅŸvuru Son Tarihi</label>
                                    <value>${formatDate(course.application_deadline)}</value>
                                </div>
                            ` : ''}
                            ${course.start_date ? `
                                <div class="detail-item">
                                    <label>ğŸ¯ BaÅŸlangÄ±Ã§ Tarihi</label>
                                    <value>${formatDate(course.start_date)}</value>
                                </div>
                            ` : ''}
                            ${course.end_date ? `
                                <div class="detail-item">
                                    <label>ğŸ BitiÅŸ Tarihi</label>
                                    <value>${formatDate(course.end_date)}</value>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` : ''}

                ${course.requirements ? `
                    <div class="detail-section">
                        <h3>âœ… Ã–n KoÅŸullar</h3>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                            <p style="margin: 0; color: #856404;">${course.requirements}</p>
                        </div>
                    </div>
                ` : ''}

                ${course.equivalency_info ? `
                    <div class="detail-section">
                        <h3>ğŸ”„ Denklik Bilgisi</h3>
                        <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                            <p style="margin: 0; color: #0c5460;">${course.equivalency_info}</p>
                        </div>
                    </div>
                ` : ''}

                ${academicianHTML}

                <div class="detail-section" style="border-bottom: none; text-align: center; padding-top: 20px;">
                    ${currentUser && currentUser.userType === 'student' && !isExpired(course.application_deadline) ? `
                        <button class="favorite-btn" onclick="toggleFavoriteFromModal(${course.id})" id="modal-fav-${course.id}" style="padding: 15px 40px; font-size: 16px;">
                            <span class="fav-icon">â™¡</span> Favoriye Ekle
                        </button>
                    ` : ''}
                    <button onclick="closeCourseDetail()" style="background: #6c757d; color: white; border: none; padding: 15px 40px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-left: 10px;">
                        âŒ Kapat
                    </button>
                </div>
            `;

            // EÄŸer Ã¶ÄŸrenci ise favori durumunu kontrol et
            if (currentUser && currentUser.userType === 'student') {
                checkFavoriteStatusInModal(course.id);
            }
        }

        function isExpired(deadlineDate) {
            if (!deadlineDate) return false;
            return new Date(deadlineDate) < new Date();
        }

        // Modal'dan favori ekleme
        async function toggleFavoriteFromModal(courseId) {
            await toggleFavorite(courseId);
            // Ana sayfadaki butonu da gÃ¼ncelle
            setTimeout(() => {
                checkFavoriteStatusInModal(courseId);
            }, 500);
        }

        // Modal iÃ§indeki favori durumunu kontrol et
        async function checkFavoriteStatusInModal(courseId) {
            if (!userToken) return;

            try {
                const response = await fetch(`${API_URL}/favorites/check/${courseId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success && data.isFavorite) {
                    const favBtn = document.getElementById(`modal-fav-${courseId}`);
                    if (favBtn) {
                        favBtn.innerHTML = '<span class="fav-icon">â™¥</span> Favorilerden Ã‡Ä±kar';
                    }
                }
            } catch (error) {
                console.error('Favori durumu kontrol hatasÄ±:', error);
            }
        }

        // Modal'Ä± kapat
        function closeCourseDetail() {
            const modal = document.getElementById('courseDetailModal');
            modal.style.display = 'none';
        }

        // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat
        window.onclick = function(event) {
            const editModal = document.getElementById('editCourseModal');
            const detailModal = document.getElementById('courseDetailModal');
            const applicationsModal = document.getElementById('applicationsModal');
            
            if (event.target === editModal) {
                closeEditCourseModal();
            }
            if (event.target === detailModal) {
                closeCourseDetail();
            }
            if (event.target === applicationsModal) {
                closeApplicationsModal();
            }
        }

        // ESC tuÅŸu ile modal'Ä± kapat
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCourseDetail();
                closeApplicationsModal();
            }
        });
        
        // Ã–ÄŸrenci: Derse baÅŸvur
        async function applyToCourse(courseId) {
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }
            
            if (!confirm('Bu derse baÅŸvurmak istediÄŸinize emin misiniz?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/summer-registrations`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify({
                        offeringId: courseId
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert('âœ… BaÅŸvurunuz baÅŸarÄ±yla alÄ±ndÄ±! Akademisyen onayÄ± bekleniyor.');
                    // Dersleri yenile
                    loadCourses();
                } else {
                    alert('âŒ Hata: ' + (data.message || 'BaÅŸvuru yapÄ±lamadÄ±'));
                }
            } catch (error) {
                console.error('BaÅŸvuru hatasÄ±:', error);
                alert('âŒ Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message);
            }
        }
        
        // Tab deÄŸiÅŸtirme
        function switchApplicationsTab(tab) {
            const applicationsTab = document.getElementById('applicationsTab');
            const enrolledTab = document.getElementById('enrolledTab');
            const applicationsTabBtn = document.getElementById('applicationsTabBtn');
            const enrolledTabBtn = document.getElementById('enrolledTabBtn');
            
            if (tab === 'applications') {
                applicationsTab.style.display = 'block';
                enrolledTab.style.display = 'none';
                applicationsTabBtn.style.background = '#667eea';
                applicationsTabBtn.style.color = 'white';
                enrolledTabBtn.style.background = '#e9ecef';
                enrolledTabBtn.style.color = '#495057';
            } else {
                applicationsTab.style.display = 'none';
                enrolledTab.style.display = 'block';
                applicationsTabBtn.style.background = '#e9ecef';
                applicationsTabBtn.style.color = '#495057';
                enrolledTabBtn.style.background = '#667eea';
                enrolledTabBtn.style.color = 'white';
                
                // KayÄ±tlÄ± Ã¶ÄŸrencileri yÃ¼kle
                const modal = document.getElementById('applicationsModal');
                const courseId = modal.dataset.courseId;
                if (courseId) {
                    loadEnrolledStudents(parseInt(courseId));
                }
            }
        }
        
        // Akademisyen: KayÄ±tlÄ± Ã¶ÄŸrencileri yÃ¼kle
        async function loadEnrolledStudents(offeringId) {
            const enrolledStudentsList = document.getElementById('enrolledStudentsList');
            
            if (!userToken) {
                enrolledStudentsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #dc3545;">LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n</p>';
                return;
            }
            
            enrolledStudentsList.innerHTML = '<div class="loading-message">YÃ¼kleniyor...</div>';
            
            try {
                const response = await fetch(`${API_URL}/summer-offerings/${offeringId}/students`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    const students = data.data || [];
                    
                    if (students.length === 0) {
                        enrolledStudentsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Bu derse henÃ¼z kayÄ±tlÄ± Ã¶ÄŸrenci bulunmuyor.</p>';
                    } else {
                        const formatDate = (dateStr) => {
                            if (!dateStr) return 'BelirtilmemiÅŸ';
                            const date = new Date(dateStr);
                            return date.toLocaleDateString('tr-TR', { 
                                day: 'numeric', 
                                month: 'long', 
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        };
                        
                        enrolledStudentsList.innerHTML = students.map(student => {
                            return `
                                <div class="application-item" style="background: #d4edda; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #28a745;">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div>
                                            <h3 style="margin: 0 0 5px 0; color: #212529;">${student.fullName}</h3>
                                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“§ ${student.email}</p>
                                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“ Ã–ÄŸrenci No: ${student.studentNumber || 'BelirtilmemiÅŸ'}</p>
                                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“… KayÄ±t Tarihi: ${formatDate(student.enrolledAt)}</p>
                                        </div>
                                        <div>
                                            <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">âœ… KayÄ±tlÄ±</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                                        <button onclick="removeStudentFromCourse(${offeringId}, ${student.id})" style="background: #dc3545; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                                            âŒ Dersten Ã‡Ä±kar
                                        </button>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                } else {
                    enrolledStudentsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #dc3545;">Ã–ÄŸrenciler yÃ¼klenirken bir hata oluÅŸtu: ' + (data.message || 'Bilinmeyen hata') + '</p>';
                }
            } catch (error) {
                console.error('KayÄ±tlÄ± Ã¶ÄŸrenciler yÃ¼kleme hatasÄ±:', error);
                enrolledStudentsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #dc3545;">Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message + '</p>';
            }
        }
        
        // Akademisyen: Ã–ÄŸrenciyi dersten Ã§Ä±kar
        async function removeStudentFromCourse(offeringId, studentCourseId) {
            if (!confirm('âš ï¸ Bu Ã¶ÄŸrenciyi dersten Ã§Ä±karmak istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz ve Ã¶ÄŸrencinin ders kaydÄ± iptal edilecektir.')) {
                return;
            }
            
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/summer-offerings/${offeringId}/students/${studentCourseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert('âœ… Ã–ÄŸrenci baÅŸarÄ±yla dersten Ã§Ä±karÄ±ldÄ±!');
                    // KayÄ±tlÄ± Ã¶ÄŸrencileri yenile
                    loadEnrolledStudents(offeringId);
                    // Dersleri yenile
                    loadCourses();
                } else {
                    alert('âŒ Hata: ' + (data.message || 'Ã–ÄŸrenci Ã§Ä±karÄ±lamadÄ±'));
                }
            } catch (error) {
                console.error('Ã–ÄŸrenci Ã§Ä±karma hatasÄ±:', error);
                alert('âŒ Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message);
            }
        }
        
        // Akademisyen: Ders baÅŸvurularÄ±nÄ± gÃ¶ster
        async function showCourseApplications(courseId) {
            console.log('showCourseApplications Ã§aÄŸrÄ±ldÄ±, courseId:', courseId);
            
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }
            
            const modal = document.getElementById('applicationsModal');
            const applicationsList = document.getElementById('applicationsList');
            
            if (!modal || !applicationsList) {
                console.error('Modal elementleri bulunamadÄ±');
                alert('Modal elementleri bulunamadÄ±');
                return;
            }
            
            modal.style.display = 'flex';
            modal.dataset.courseId = courseId;
            
            // Ä°lk tab'Ä± gÃ¶ster (baÅŸvurular)
            switchApplicationsTab('applications');
            
            applicationsList.innerHTML = '<div class="loading-message">YÃ¼kleniyor...</div>';
            
            try {
                console.log('BaÅŸvurular yÃ¼kleniyor, courseId:', courseId, 'URL:', `${API_URL}/summer-registrations/offering/${courseId}`);
                const response = await fetch(`${API_URL}/summer-registrations/offering/${courseId}`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('API hatasÄ±:', errorData);
                    throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('BaÅŸvurular verisi:', data);
                console.log('BaÅŸvurular verisi:', data);
                
                if (data.success) {
                    const registrations = data.data || [];
                    console.log('BaÅŸvuru sayÄ±sÄ±:', registrations.length);
                    
                    if (registrations.length === 0) {
                        applicationsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">HenÃ¼z baÅŸvuru yapÄ±lmamÄ±ÅŸ.</p>';
                    } else {
                        applicationsList.innerHTML = registrations.map(reg => {
                            const formatDate = (dateStr) => {
                                if (!dateStr) return 'BelirtilmemiÅŸ';
                                const date = new Date(dateStr);
                                return date.toLocaleDateString('tr-TR', { 
                                    day: 'numeric', 
                                    month: 'long', 
                                    year: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                            };
                            
                            const studentName = `${reg.first_name || ''} ${reg.last_name || ''}`.trim() || 'Ã–ÄŸrenci';
                            const studentEmail = reg.email || 'E-posta bulunamadÄ±';
                            
                            const statusBadge = {
                                'pending': '<span style="background: #ffc107; color: #212529; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">â³ Beklemede</span>',
                                'approved': '<span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">âœ… OnaylandÄ±</span>',
                                'rejected': '<span style="background: #dc3545; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em; font-weight: bold;">âŒ Reddedildi</span>'
                            };
                            
                            return `
                                <div class="application-item" style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid ${reg.status === 'approved' ? '#28a745' : reg.status === 'rejected' ? '#dc3545' : '#ffc107'};">
                                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                        <div>
                                            <h3 style="margin: 0 0 5px 0; color: #212529;">${studentName}</h3>
                                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“§ ${studentEmail}</p>
                                            ${reg.student_number ? `<p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“ Ã–ÄŸrenci No: ${reg.student_number}</p>` : ''}
                                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ“… BaÅŸvuru Tarihi: ${formatDate(reg.application_date)}</p>
                                            ${reg.status_updated_at ? `<p style="margin: 5px 0; color: #666; font-size: 0.9em;">ğŸ”„ Durum GÃ¼ncelleme: ${formatDate(reg.status_updated_at)}</p>` : ''}
                                        </div>
                                        <div>
                                            ${statusBadge[reg.status] || statusBadge.pending}
                                        </div>
                                    </div>
                                    ${reg.application_note ? `
                                        <div style="background: white; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                                            <strong>ğŸ“ BaÅŸvuru Notu:</strong>
                                            <p style="margin: 5px 0 0 0; color: #495057;">${reg.application_note}</p>
                                        </div>
                                    ` : ''}
                                    ${reg.rejection_reason ? `
                                        <div style="background: #f8d7da; padding: 10px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #dc3545;">
                                            <strong>âŒ Red Nedeni:</strong>
                                            <p style="margin: 5px 0 0 0; color: #721c24;">${reg.rejection_reason}</p>
                                        </div>
                                    ` : ''}
                                    ${reg.status === 'pending' ? `
                                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                                            <button onclick="updateApplicationStatus(${reg.id}, 'approved', ${courseId})" style="background: #28a745; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                                                âœ… Onayla
                                            </button>
                                            <button onclick="updateApplicationStatus(${reg.id}, 'rejected', ${courseId})" style="background: #dc3545; color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1;">
                                                âŒ Reddet
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                } else {
                    applicationsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #dc3545;">BaÅŸvurular yÃ¼klenirken bir hata oluÅŸtu: ' + (data.message || 'Bilinmeyen hata') + '</p>';
                }
            } catch (error) {
                console.error('BaÅŸvurular yÃ¼kleme hatasÄ±:', error);
                applicationsList.innerHTML = '<p style="text-align: center; padding: 2rem; color: #dc3545;">Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message + '</p>';
            }
        }
        
        // Akademisyen: BaÅŸvuru durumunu gÃ¼ncelle
        async function updateApplicationStatus(registrationId, status, courseId) {
            if (!userToken) {
                alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n');
                return;
            }
            
            const action = status === 'approved' ? 'onaylamak' : 'reddetmek';
            if (!confirm(`Bu baÅŸvuruyu ${action} istediÄŸinize emin misiniz?`)) {
                return;
            }
            
            let rejectionReason = null;
            if (status === 'rejected') {
                rejectionReason = prompt('Red nedeni (isteÄŸe baÄŸlÄ±):');
                if (rejectionReason === null) {
                    return; // KullanÄ±cÄ± iptal etti
                }
            }
            
            try {
                const response = await fetch(`${API_URL}/summer-registrations/${registrationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userToken}`
                    },
                    body: JSON.stringify({
                        status: status,
                        rejectionReason: rejectionReason || undefined
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    alert(`âœ… BaÅŸvuru ${status === 'approved' ? 'onaylandÄ±' : 'reddedildi'}!`);
                    // BaÅŸvurularÄ± yenile - modal'dan courseId'yi al
                    const modal = document.getElementById('applicationsModal');
                    const currentCourseId = modal.dataset.courseId || courseId;
                    if (currentCourseId) {
                        await showCourseApplications(parseInt(currentCourseId));
                    }
                    // Dersleri yenile
                    loadCourses();
                } else {
                    alert('âŒ Hata: ' + (data.message || 'BaÅŸvuru durumu gÃ¼ncellenemedi'));
                }
            } catch (error) {
                console.error('BaÅŸvuru durumu gÃ¼ncelleme hatasÄ±:', error);
                alert('âŒ Sunucuya baÄŸlanÄ±lamadÄ±: ' + error.message);
            }
        }
        
        // BaÅŸvurular modal'Ä±nÄ± kapat
        function closeApplicationsModal() {
            const modal = document.getElementById('applicationsModal');
            modal.style.display = 'none';
            delete modal.dataset.courseId;
        }
    </script>

</body>
</html>