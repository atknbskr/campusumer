<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fak√ºlteler - Campus Summer</title>
    <link rel="stylesheet" href="fak√ºlteler.css">
</head>
<body>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="2.3.logo.png" alt="Campus Summer Logo">
                <span>Campus Summer</span> 
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="../campusumer-anasayfa/anasayfa.html" class="nav-link">Anasayfa</a>
                </div>
                <div class="nav-item">
                    <a href="../Dersler/dersler.html" class="nav-link">Dersler</a>
                </div>
                <div class="nav-item">
                    <a href="../√úniversiteler/√úniversitler.html" class="nav-link">√úniversiteler</a>
                </div>
                <div class="nav-item">
                    <a href="fak√ºlteler.html" class="nav-link active">Fak√ºlteler</a>
                </div>
                <div class="nav-item">
                    <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html" class="nav-link">Hakkƒ±mƒ±zda</a>
                </div>
                <div class="nav-item">
                    <a href="../ƒ∞leti≈üim/iletisim.html" class="nav-link">ƒ∞leti≈üim</a>
                </div>
            </nav>
        </div>
    </header>

    <section class="page-hero">
        <div class="container">
            <div class="hero-content">
                <h1>Fak√ºlteler</h1>
                <p>T√ºrkiye'nin √∂nde gelen √ºniversitelerinin fak√ºltelerini ke≈üfedin ve yaz dersi se√ßeneklerini inceleyin.</p>
            </div>
        </div>
    </section>

    <!-- √ñƒürenci Filtreleme Section -->
    <section id="studentFilterSection" class="filter-section" style="display: none; background: #f8f9fa; padding: 40px 0;">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.8rem; color: #333;">üîç Fak√ºlte Filtrele</h2>
                <p style="color: #666; font-size: 0.95rem;">√úniversiteye g√∂re fak√ºlteleri g√∂r√ºnt√ºleyin</p>
            </div>
            <div class="filter-form-container" style="max-width: 600px; margin: 0 auto; background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);">
                <form id="filterForm" class="filter-form">
                    <div class="form-group" style="margin-bottom: 1.2rem;">
                        <label for="filterUniversity" style="font-size: 0.92rem; color: #495057; font-weight: 600;">√úniversite Se√ßin</label>
                        <select id="filterUniversity" name="filterUniversity" style="font-size: 0.95rem;">
                            <option value="">T√ºm √úniversiteler</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 0.6rem; justify-content: center; flex-wrap: wrap; margin-top: 0.8rem;">
                        <button type="submit" class="filter-submit-btn">
                            üîç Fak√ºlteleri G√∂ster
                        </button>
                        <button type="button" onclick="clearFilter()" class="filter-clear-btn">
                            üóëÔ∏è Temizle
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Akademisyen Fak√ºlte Ekleme Section -->
    <section id="academicianSection" class="academician-section" style="display: none; background: #f8f9fa; padding: 60px 0;">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 2rem;">
                <h2 style="font-size: 2rem; color: #333;">Fak√ºlte Ekle</h2>
                <p style="color: #666;">Yeni bir fak√ºlte ekleyin</p>
            </div>
            <div class="add-course-form-container" style="max-width: 600px; margin: 0 auto; background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);">
                <form id="addFacultyForm" class="add-course-form">
                    <div class="form-group">
                        <label for="facultyName">Fak√ºlte Adƒ± *</label>
                        <input type="text" id="facultyName" name="facultyName" required>
                    </div>
                    <div class="form-group">
                        <label for="facultyDescription">A√ßƒ±klama</label>
                        <textarea id="facultyDescription" name="facultyDescription" rows="4"></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Fak√ºlte Ekle</button>
                    <div id="facultyFormMessage" class="form-message"></div>
                </form>
            </div>
        </div>
    </section>

    <section class="faculties-section">
        <div class="container">
            <div class="section-header" style="text-align: center; margin-bottom: 3rem;">
                <h2 id="sectionTitle" style="font-size: 2.5rem; color: #333; margin-bottom: 1rem;">Fak√ºlteler</h2>
                <p id="sectionSubtitle" style="color: #666; font-size: 1.1rem;">√úniversitelerin fak√ºltelerini ke≈üfedin</p>
            </div>
            
            <div id="loadingMessage" class="loading-message" style="text-align: center; padding: 3rem; font-size: 1.2rem; color: #666;">Y√ºkleniyor...</div>
            <div class="faculties-grid" id="facultiesGrid">
                <!-- Fak√ºlteler buraya dinamik olarak eklenecek -->

            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Campus Summer</h3>
                    <p>T√ºrkiye'nin en kapsamlƒ± yaz dersleri takip platformu. Akademik hedeflerinize ula≈ümanƒ±n en kolay yolu.</p>
                </div>
                <div class="footer-section">
                    <h3>Hƒ±zlƒ± Baƒülantƒ±lar</h3>
                    <a href="../campusumer-anasayfa/anasayfa.html">Ana Sayfa</a>
                    <a href="../√úniversiteler/√úniversitler.html">√úniversiteler</a>
                    <a href="../Dersler/dersler.html">Dersler</a>
                    <a href="../Hakkƒ±mƒ±zda/Hakkƒ±mƒ±zda.html">Hakkƒ±mƒ±zda</a>
                </div>
                <div class="footer-section">
                    <h3>Destek</h3>                    
                    <a href="../ƒ∞leti≈üim/iletisim.html">ƒ∞leti≈üim</a>
                    <a href="../Gizlilik-politikasƒ±/gizlilikpolitikasƒ±.html">Gizlilik Politikasƒ±</a>
                </div>
                <div class="footer-section">
                    <h3>ƒ∞leti≈üim</h3>
                    <p>üìß atakan.baskir@std.hku.edu.tr</p>
                    <p>üìû +90 506 536 1780</p>
                    <p>üìç Gaziantep, T√ºrkiye</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Campus Summer. T√ºm haklarƒ± saklƒ±dƒ±r.</p>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = 'http://localhost:5500/api';
        
        // Kullanƒ±cƒ± bilgilerini al
        let currentUser = null;
        let userToken = null;

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', () => {
            // LocalStorage'dan kullanƒ±cƒ± bilgilerini al
            const userStr = localStorage.getItem('user');
            userToken = localStorage.getItem('token');
            
            if (userStr && userToken) {
                currentUser = JSON.parse(userStr);
                console.log('‚úÖ Kullanƒ±cƒ± giri≈üi tespit edildi:', currentUser.userType);
                initializePage();
            } else {
                // Giri≈ü yapƒ±lmamƒ±≈üsa, t√ºm fak√ºlteleri g√∂ster
                console.log('üë§ Ziyaret√ßi modu - T√ºm fak√ºlteler g√∂steriliyor');
                loadFaculties();
            }
        });

        async function initializePage() {
            if (currentUser.userType === 'academician') {
                // Akademisyen aray√ºz√º
                document.getElementById('academicianSection').style.display = 'block';
                document.getElementById('sectionTitle').textContent = 'Fak√ºltelerim';
                document.getElementById('sectionSubtitle').textContent = currentUser.universityName ? 
                    `${currentUser.universityName} - Fak√ºlteler` : 'Eklediƒüiniz fak√ºlteler';
                setupAcademicianFeatures();
                loadFaculties();
            } else if (currentUser.userType === 'student') {
                // √ñƒürenci aray√ºz√º - Filtreleme g√∂ster
                document.getElementById('studentFilterSection').style.display = 'block';
                document.getElementById('sectionTitle').textContent = 'Fak√ºlteler';
                document.getElementById('sectionSubtitle').textContent = '√úniversitelere g√∂re fak√ºlteleri filtreleyin';
                setupStudentFilter();
                // Fak√ºlteleri hemen y√ºkleme, filtreleme sonrasƒ± y√ºklenecek
                document.getElementById('facultiesGrid').innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666; font-size: 1.05rem;">üëÜ Yukarƒ±daki filtreden √ºniversite se√ßerek fak√ºlteleri g√∂r√ºnt√ºleyin</p>';
                document.getElementById('loadingMessage').style.display = 'none';
            } else {
                // Ziyaret√ßi - T√ºm fak√ºlteleri g√∂ster
                loadFaculties();
            }
        }

        function setupAcademicianFeatures() {
            // Fak√ºlte ekleme formu
            document.getElementById('addFacultyForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('facultyName').value.trim(),
                    description: document.getElementById('facultyDescription').value.trim() || null,
                    universityId: currentUser.universityId
                };

                try {
                    const response = await fetch(`${API_URL}/faculties`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${userToken}`
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();
                    const messageDiv = document.getElementById('facultyFormMessage');
                    
                    if (response.ok && data.success) {
                        messageDiv.textContent = 'Fak√ºlte ba≈üarƒ±yla eklendi!';
                        messageDiv.className = 'form-message success';
                        messageDiv.style.color = '#28a745';
                        messageDiv.style.padding = '10px';
                        messageDiv.style.marginTop = '10px';
                        document.getElementById('addFacultyForm').reset();
                        loadFaculties();
                    } else {
                        messageDiv.textContent = data.message || 'Fak√ºlte eklenirken hata olu≈ütu';
                        messageDiv.className = 'form-message error';
                        messageDiv.style.color = '#dc3545';
                        messageDiv.style.padding = '10px';
                        messageDiv.style.marginTop = '10px';
                    }
                } catch (error) {
                    console.error('Fak√ºlte ekleme hatasƒ±:', error);
                    const messageDiv = document.getElementById('facultyFormMessage');
                    messageDiv.textContent = `Sunucuya baƒülanƒ±lamadƒ±: ${error.message}`;
                    messageDiv.className = 'form-message error';
                    messageDiv.style.color = '#dc3545';
                }
            });
        }

        async function setupStudentFilter() {
            // √úniversiteleri y√ºkle
            try {
                const response = await fetch(`${API_URL}/universities`);
                const data = await response.json();
                
                if (data.success && data.universities) {
                    const select = document.getElementById('filterUniversity');
                    data.universities.forEach(uni => {
                        const option = document.createElement('option');
                        option.value = uni.id;
                        option.textContent = uni.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('√úniversiteler y√ºklenirken hata:', error);
            }

            // Filtreleme formunu dinle
            document.getElementById('filterForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                applyFilter();
            });
        }

        async function applyFilter() {
            const universityId = document.getElementById('filterUniversity').value;

            console.log('Filtreleme yapƒ±lƒ±yor:', { universityId });
            
            const loadingDiv = document.getElementById('loadingMessage');
            const gridDiv = document.getElementById('facultiesGrid');
            
            loadingDiv.style.display = 'block';
            gridDiv.innerHTML = '';

            try {
                let url = `${API_URL}/faculties`;
                
                if (universityId) {
                    url += `?universityId=${universityId}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (response.ok && data.success) {
                    const faculties = data.faculties;
                    
                    if (faculties.length > 0) {
                        displayFaculties(faculties);
                    } else {
                        gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666; font-size: 1.1rem;">üîç Bu √ºniversiteye ait fak√ºlte bulunamadƒ±.</p>';
                    }
                } else {
                    gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545;">Fak√ºlteler y√ºklenirken bir hata olu≈ütu</p>';
                }
            } catch (error) {
                console.error('Fak√ºlte y√ºkleme hatasƒ±:', error);
                gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545;">Sunucuya baƒülanƒ±lamadƒ±</p>';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function clearFilter() {
            document.getElementById('filterForm').reset();
            const gridDiv = document.getElementById('facultiesGrid');
            gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666; font-size: 1.05rem;">üëÜ Yukarƒ±daki filtreden √ºniversite se√ßerek fak√ºlteleri g√∂r√ºnt√ºleyin</p>';
            document.getElementById('loadingMessage').style.display = 'none';
        }

        async function loadFaculties(customUrl = null) {
            const loadingDiv = document.getElementById('loadingMessage');
            const gridDiv = document.getElementById('facultiesGrid');
            
            loadingDiv.style.display = 'block';
            gridDiv.innerHTML = '';

            try {
                let url = customUrl || `${API_URL}/faculties`;
                let headers = { 'Content-Type': 'application/json' };

                // Eƒüer akademisyen ise, kendi √ºniversitesinin fak√ºltelerini getir
                if (!customUrl && currentUser && currentUser.userType === 'academician' && currentUser.universityId) {
                    url = `${API_URL}/faculties?universityId=${currentUser.universityId}`;
                    headers['Authorization'] = `Bearer ${userToken}`;
                }

                console.log('Fak√ºlteler y√ºkleniyor:', url);
                const response = await fetch(url, { headers });
                const data = await response.json();

                if (response.ok && data.success) {
                    if (data.faculties && data.faculties.length > 0) {
                        displayFaculties(data.faculties);
                    } else {
                        gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666; font-size: 1.1rem;">üîç Arama kriterlerinize uygun fak√ºlte bulunamadƒ±. L√ºtfen farklƒ± bir filtre deneyin.</p>';
                    }
                } else {
                    gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545;">Fak√ºlteler y√ºklenirken bir hata olu≈ütu</p>';
                }
            } catch (error) {
                console.error('Fak√ºlte y√ºkleme hatasƒ±:', error);
                gridDiv.innerHTML = '<p class="error-message" style="grid-column: 1/-1; text-align: center; color: #dc3545;">Sunucuya baƒülanƒ±lamadƒ±</p>';
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function displayFaculties(faculties) {
            const gridDiv = document.getElementById('facultiesGrid');
            
            if (faculties.length === 0) {
                gridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #666; font-size: 1.1rem;">Hen√ºz fak√ºlte eklenmemi≈ü</p>';
                return;
            }

            // Fak√ºlte ikonlarƒ±
            const facultyIcons = {
                'M√ºhendislik': '‚öôÔ∏è',
                'Tƒ±p': 'üè•',
                'Hukuk': '‚öñÔ∏è',
                'ƒ∞ktisadi': 'üíº',
                'Fen': 'üî¨',
                'Edebiyat': 'üìö',
                'Mimarlƒ±k': 'üèõÔ∏è',
                'G√ºzel Sanatlar': 'üé®',
                'Eƒüitim': 'üéì',
                'Saƒülƒ±k': 'ü©∫',
                'ƒ∞leti≈üim': 'üì∫',
                'Di≈ü': 'ü¶∑'
            };

            faculties.forEach(faculty => {
                const card = document.createElement('div');
                card.className = 'faculty-card';
                card.dataset.facultyId = faculty.id;

                // ƒ∞kon se√ß
                let icon = 'üèõÔ∏è';
                for (let [key, value] of Object.entries(facultyIcons)) {
                    if (faculty.name.includes(key)) {
                        icon = value;
                        break;
                    }
                }

                const isMyFaculty = currentUser && currentUser.userType === 'academician';

                card.innerHTML = `
                    <div class="faculty-icon">${icon}</div>
                    <h3>${faculty.name}</h3>
                    <p class="faculty-description">${faculty.description || 'A√ßƒ±klama bulunmuyor'}</p>
                    ${faculty.university_name ? `<p class="university-name" style="color: #2196F3; font-size: 0.9rem; margin: 0.5rem 0;">üèõÔ∏è ${faculty.university_name}</p>` : ''}
                    ${faculty.academician_name ? `<p class="academician-name" style="color: #666; font-size: 0.85rem;">üë§ ${faculty.academician_name}</p>` : ''}
                    <p class="faculty-date" style="color: #999; font-size: 0.8rem; margin-top: 1rem;">üìÖ ${new Date(faculty.created_at).toLocaleDateString('tr-TR')}</p>
                    ${isMyFaculty ? `
                        <div class="course-actions" style="margin-top: 1rem;">
                            <button class="delete-btn" onclick="deleteFaculty(${faculty.id})" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 500;">Fak√ºlteyi Sil</button>
                        </div>
                    ` : ''}
                `;

                gridDiv.appendChild(card);
            });
        }

        async function deleteFaculty(facultyId) {
            if (!confirm('Bu fak√ºlteyi silmek istediƒüinize emin misiniz?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/faculties/${facultyId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    // Fak√ºlteyi DOM'dan kaldƒ±r
                    const card = document.querySelector(`[data-faculty-id="${facultyId}"]`);
                    if (card) {
                        card.remove();
                    }
                    alert('Fak√ºlte ba≈üarƒ±yla silindi');
                    loadFaculties(); // Listeyi yenile
                } else {
                    alert(data.message || 'Fak√ºlte silinirken bir hata olu≈ütu');
                }
            } catch (error) {
                console.error('Fak√ºlte silme hatasƒ±:', error);
                alert('Sunucuya baƒülanƒ±lamadƒ±');
            }
        }

        // CSS animasyonu
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .form-message {
                padding: 10px;
                margin-top: 10px;
                border-radius: 8px;
                text-align: center;
            }
            .form-message.success {
                background: #d4edda;
                color: #155724;
            }
            .form-message.error {
                background: #f8d7da;
                color: #721c24;
            }
            .submit-btn {
                background: linear-gradient(45deg, #2196F3, #00BCD4);
                color: white;
                border: none;
                padding: 12px 32px;
                border-radius: 25px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                width: 100%;
            }
            .submit-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(33,150,243,0.4);
            }
            .filter-submit-btn {
                background: linear-gradient(135deg, #2196F3 0%, #00BCD4 100%);
                color: white;
                border: none;
                padding: 11px 28px;
                border-radius: 10px;
                font-size: 0.95rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 3px 12px rgba(33,150,243,0.25);
                min-width: 180px;
                letter-spacing: 0.3px;
            }
            .filter-submit-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 24px rgba(33,150,243,0.4);
                background: linear-gradient(135deg, #1e88e5 0%, #00ACC1 100%);
            }
            .filter-submit-btn:active {
                transform: translateY(-1px);
                box-shadow: 0 4px 16px rgba(33,150,243,0.3);
            }
            .filter-clear-btn {
                background: white;
                color: #6c757d;
                border: 2px solid #dee2e6;
                padding: 11px 24px;
                border-radius: 10px;
                font-size: 0.95rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
                min-width: 120px;
                letter-spacing: 0.3px;
            }
            .filter-clear-btn:hover {
                background: #f8f9fa;
                border-color: #adb5bd;
                color: #495057;
                transform: translateY(-3px);
                box-shadow: 0 6px 16px rgba(108,117,125,0.15);
            }
            .filter-clear-btn:active {
                transform: translateY(-1px);
                box-shadow: 0 3px 10px rgba(108,117,125,0.1);
            }
            .form-group {
                margin-bottom: 1.5rem;
            }
            .form-group label {
                display: block;
                font-weight: 600;
                color: #555;
                margin-bottom: 0.5rem;
            }
            .form-group input,
            .form-group textarea,
            .form-group select {
                width: 100%;
                padding: 11px 16px;
                border: 2px solid #e1e8ed;
                border-radius: 10px;
                font-size: 0.95rem;
                font-family: inherit;
                transition: all 0.25s ease;
                box-sizing: border-box;
                background: #fafbfc;
                color: #495057;
                cursor: pointer;
            }
            .form-group input:focus,
            .form-group textarea:focus,
            .form-group select:focus {
                outline: none;
                border-color: #2196F3;
                box-shadow: 0 0 0 4px rgba(33,150,243,0.1);
                background: white;
            }
            .form-group select:hover {
                border-color: #c8d3dd;
                background: white;
            }
            @media (max-width: 768px) {
                .form-row {
                    grid-template-columns: 1fr !important;
                }
                .filter-submit-btn {
                    min-width: 150px;
                    padding: 10px 20px;
                    font-size: 0.9rem;
                }
                .filter-clear-btn {
                    min-width: 100px;
                    padding: 10px 18px;
                    font-size: 0.9rem;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

</body>
</html>